# React Forms Comparison Demo - Setup Instructions

This project demonstrates the difference between traditional React form management (using useState) and modern approaches (using React Hook Form + React Query with Orval-generated API client).

## Project Structure

```
orval-experiment-251111/
├── openapi.yaml                    # OpenAPI 3.0 specification
├── orval.config.ts                 # Orval configuration
├── package.json                    # Main project dependencies
├── vite.config.ts                  # Vite configuration
├── tsconfig.json                   # TypeScript configuration
├── index.html                      # HTML entry point
│
├── mock-server/                    # Express mock API server
│   ├── package.json               # Server dependencies
│   └── server.js                  # Express server code
│
└── src/
    ├── main.tsx                   # React entry point
    ├── App.tsx                    # Main app with QueryClientProvider
    ├── api/
    │   ├── custom-instance.ts     # Custom Axios instance
    │   ├── generated.ts           # Generated by Orval (DO NOT EDIT)
    │   └── model/                 # Generated TypeScript types
    └── components/
        ├── TraditionalForm.tsx    # useState approach
        └── ModernForm.tsx         # React Hook Form + React Query
```

## Prerequisites

- Node.js (v18 or higher recommended)
- npm or yarn

## Installation & Setup

### Step 1: Install Main Project Dependencies

```bash
npm install
```

This installs:
- React & React DOM
- TypeScript
- Vite (build tool)
- React Hook Form (form state management)
- React Query / TanStack Query (server state management)
- Axios (HTTP client)
- Orval (OpenAPI code generator)

### Step 2: Install Mock Server Dependencies

```bash
cd mock-server
npm install
cd ..
```

This installs:
- Express (web server)
- CORS (Cross-Origin Resource Sharing middleware)

### Step 3: Generate API Client with Orval

```bash
npm run generate-api
```

Or directly:
```bash
npx orval
```

This reads `openapi.yaml` and generates:
- `src/api/generated.ts` - React Query hooks (useGetUserProfile, useUpdateUserProfile)
- `src/api/model/` - TypeScript types (UserProfile, UpdateUserProfileRequest, etc.)

**Note:** You need to regenerate the API client whenever you change `openapi.yaml`.

## Running the Demo

You need to run **TWO** processes simultaneously:

### Terminal 1: Start the Mock API Server

```bash
cd mock-server
npm start
```

Or from the root directory:
```bash
npm run server
```

The server will start on **http://localhost:3001** with the following endpoints:
- `GET /api/users/:userId` - Fetch user profile (500ms delay)
- `PUT /api/users/:userId` - Update user profile (800ms delay)

Sample user IDs available: `1`, `2`, `3`

### Terminal 2: Start the Vite Dev Server

```bash
npm run dev
```

The React app will start on **http://localhost:5173** (or another port if 5173 is taken).

## Using the Demo

1. Open your browser to `http://localhost:5173`
2. You'll see two forms side-by-side:
   - **Left**: Traditional approach using useState
   - **Right**: Modern approach using React Hook Form + React Query
3. Both forms load the same user data (User ID: 1)
4. Try editing fields in both forms
5. Notice how the "Save" button enables when you make changes (dirty state tracking)
6. Click "Save Changes" to submit (watch for the loading state)
7. Try the "Reset" button to restore original values
8. Both forms interact with the real mock API server

## Development Workflow

### Modifying the API

1. Edit `openapi.yaml` to change/add endpoints or schemas
2. Regenerate the API client: `npm run generate-api`
3. Update your components to use the new generated hooks/types

### Adding New Endpoints

Example: Adding a DELETE endpoint

1. Add to `openapi.yaml`:
```yaml
/users/{userId}:
  delete:
    operationId: deleteUser
    # ... rest of specification
```

2. Add handler to `mock-server/server.js`:
```javascript
app.delete('/api/users/:userId', async (req, res) => {
  // ... implementation
});
```

3. Regenerate: `npm run generate-api`
4. Use in your components: `import { useDeleteUser } from './api/generated'`

## Key Technologies

### Frontend
- **React 18** - UI library
- **TypeScript** - Type safety
- **Vite** - Build tool and dev server
- **React Hook Form** - Form state management
- **React Query (TanStack Query)** - Server state management
- **Axios** - HTTP client
- **Orval** - OpenAPI to TypeScript generator

### Backend (Mock)
- **Express** - Web server
- **CORS** - Cross-origin support

## Understanding the Comparison

### Traditional Approach (`TraditionalForm.tsx`)
- **~250 lines of code**
- 13 separate `useState` hooks
- 2 `useEffect` hooks (data fetching + dirty tracking)
- 7 manual change handlers
- Manual error handling with try/catch
- Manual loading state management
- Manual dirty state tracking

### Modern Approach (`ModernForm.tsx`)
- **~120 lines of code** (52% less!)
- 0 `useState` hooks (React Hook Form handles form state)
- 0 `useEffect` hooks (React Query handles data fetching)
- 1 submit handler (React Hook Form provides the data)
- Automatic error handling via React Query
- Automatic loading states
- Built-in dirty state tracking with `formState.isDirty`

## Troubleshooting

### Port Already in Use

If port 3001 or 5173 is already in use:

**For mock server:** Edit `mock-server/server.js` and change `PORT = 3001` to another port. Also update `src/api/custom-instance.ts` baseURL.

**For Vite:** Edit `vite.config.ts` and change the port in the `server` section.

### CORS Issues

Make sure the mock server is running and CORS is enabled (already configured in `server.js`).

### API Client Not Generated

If imports from `./api/generated` fail:
1. Verify `openapi.yaml` is valid
2. Run `npm run generate-api`
3. Check that `src/api/generated.ts` exists

### TypeScript Errors

After generating the API client, if you see TypeScript errors:
1. Restart your TypeScript server (in VS Code: Cmd/Ctrl + Shift + P → "TypeScript: Restart TS Server")
2. Verify all dependencies are installed: `npm install`

## Next Steps

1. Try modifying the forms to add new fields (e.g., `age`, `country`)
2. Update `openapi.yaml` with the new fields
3. Regenerate the API client
4. See how the modern approach requires minimal changes

## Learn More

- [React Hook Form Documentation](https://react-hook-form.com/)
- [TanStack Query Documentation](https://tanstack.com/query/latest)
- [Orval Documentation](https://orval.dev/)
- [OpenAPI Specification](https://swagger.io/specification/)
